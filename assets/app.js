webpackJsonp([0],{110:function(module,exports){},122:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"601aa39318bb5d828cac1b4bdc49f6f1.png"},123:function(module,exports,__webpack_require__){module.exports=__webpack_require__(61)},61:function(module,exports,__webpack_require__){"use strict";(function(global){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _classCallCheck2=__webpack_require__(15),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(17),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(16),_inherits3=_interopRequireDefault(_inherits2);__webpack_require__(110);var _react=__webpack_require__(2),_react2=_interopRequireDefault(_react),_reactDom=__webpack_require__(2),_reactDom2=_interopRequireDefault(_reactDom),_preactRouter=__webpack_require__(56),_preactRouter2=_interopRequireDefault(_preactRouter),_header=__webpack_require__(63),_header2=_interopRequireDefault(_header),_home=__webpack_require__(64),_home2=_interopRequireDefault(_home),_graffiti=__webpack_require__(62),_graffiti2=_interopRequireDefault(_graffiti);global.Promise=__webpack_require__(70);var App=function(_React$Component){function App(){(0,_classCallCheck3["default"])(this,App);var _this=(0,_possibleConstructorReturn3["default"])(this,_React$Component.call(this));return _this.state={currentRoute:null},_this.handleRoute=_this.handleRoute.bind(_this),_this}return(0,_inherits3["default"])(App,_React$Component),App.prototype.handleRoute=function(e){this.setState({currentRoute:e.url})},App.prototype.render=function(props,state){return _react2["default"].createElement("div",{"class":"app"},_react2["default"].createElement(_header2["default"],{currentRoute:state.currentRoute}),_react2["default"].createElement(_preactRouter2["default"],{onChange:this.handleRoute},_react2["default"].createElement(_home2["default"],{path:"/"}),_react2["default"].createElement(_graffiti2["default"],{path:"/graffiti"}),_react2["default"].createElement(Error,{type:"404","default":!0})))},App}(_react2["default"].Component);_reactDom2["default"].render(_react2["default"].createElement(App,null),document.querySelector("#root"))}).call(exports,__webpack_require__(60))},62:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _promise=__webpack_require__(67),_promise2=_interopRequireDefault(_promise),_classCallCheck2=__webpack_require__(15),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(17),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(16),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(2),_react2=_interopRequireDefault(_react),_input=__webpack_require__(118),_input2=_interopRequireDefault(_input),_fetchJsonp=__webpack_require__(111),_fetchJsonp2=_interopRequireDefault(_fetchJsonp),Graffiti=function(_Component){function Graffiti(){(0,_classCallCheck3["default"])(this,Graffiti);var _this=(0,_possibleConstructorReturn3["default"])(this,_Component.call(this));return _this.state={token:"",tokenValid:!1,url:"",error:"",link:"",message:""},_this.handleToken=_this.handleToken.bind(_this),_this.handleURL=_this.handleURL.bind(_this),_this.handleLink=_this.handleLink.bind(_this),_this.parseJSON=_this.parseJSON.bind(_this),_this.checkStatus=_this.checkStatus.bind(_this),_this.handleClearFile=_this.handleClearFile.bind(_this),_this}return(0,_inherits3["default"])(Graffiti,_Component),Graffiti.prototype.checkStatus=function(response){return response.status>=200&&response.status<300?response:response.json().then(function(json){var message;return json.message?message="File too large"==json.message&&"Размер файла превышает 4мб"||json.message:json.error&&5==json.error.error_code&&(message="Токен неправильный или устарел"),_promise2["default"].reject(new Error(message))})},Graffiti.prototype.checkStatusP=function(response){return response.json().then(function(json){if(json.response)return response;if(json.error&&5==json.error.error_code){var message="Токен неправильный или устарел";return _promise2["default"].reject(new Error(message))}})},Graffiti.prototype.parseJSON=function(response){return response.json()},Graffiti.prototype.handleGetToken=function(){window.open("https://oauth.vk.com/authorize?client_id=5553668&scope=docs&response_type=token")},Graffiti.prototype.handleToken=function(e){this.setState({token:e.target.value,tokenValid:/access_token=(.+)&expires_in/.test(e.target.value)})},Graffiti.prototype.handleURL=function(e){this.setState({url:e.target.value})},Graffiti.prototype.handleLink=function(){var _this2=this;this.setState({error:"",message:"",link:""});var tokenEl=this.state.token,fileEl=this.refs.file;if(0==fileEl.files.length&&0==this.state.url.length)return this.setState({error:"Не выбран файл или не заполнено поле юрл"}),!1;var _$exec=/access_token=(.+)&expires_in/.exec(tokenEl),token=_$exec[1],fd=new FormData;fd.append("file",fileEl.files[0]);var regex=/pu\.vk\.com\/([a-z0-9]+)\/upload\.php\?act=add_doc&mid=([0-9]+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)&api=1/i;(0,_fetchJsonp2["default"])("https://api.vk.com/method/docs.getUploadServer?v=5.54&access_token="+token+"&type=graffiti").then(this.checkStatusP).then(this.parseJSON).then(function(uploadServer){_this2.setState({message:"Загрузка изображения, подождите"});var _regex$exec=regex.exec(uploadServer.response.upload_url),c=_regex$exec[1],mid=_regex$exec[2],hash=_regex$exec[3],rhash=_regex$exec[4];return fileEl.files.length>0?fetch("https://akigami.ru/vkgraffiti/upload_by_file?c="+c+"&mid="+mid+"&hash="+hash+"&rhash="+rhash,{method:"POST",body:fd}).then(_this2.checkStatus).then(_this2.parseJSON):_this2.state.url?fetch("https://akigami.ru/vkgraffiti/upload_by_url?url="+_this2.state.url+"&c="+c+"&mid="+mid+"&hash="+hash+"&rhash="+rhash,{method:"POST"}).then(_this2.checkStatus).then(_this2.parseJSON):void 0}).then(function(responseFile){return(0,_fetchJsonp2["default"])("https://api.vk.com/method/docs.save?v=5.54&access_token="+token+"&file="+responseFile.file).then(_this2.parseJSON)}).then(function(responseDoc){var doc=responseDoc.response[0],link="https://vk.com/doc"+doc.owner_id+"_"+doc.id;_this2.setState({link:link,err:"",message:""})})["catch"](function(err){_this2.setState({error:err.message,link:"",message:""})})},Graffiti.prototype.handleClearFile=function(){this.refs.file.value=""},Graffiti.prototype.render=function(props,state){return _react2["default"].createElement("div",{className:"center-container"},_react2["default"].createElement("div",{className:"center"},_react2["default"].createElement("button",{className:"ui button",onClick:this.handleGetToken},"Получить токен"),_react2["default"].createElement("div",null,"Вставьте полностью весь юрл"),_react2["default"].createElement(_input2["default"],{type:"text",fluid:!0,value:state.token,onKeyUp:this.handleToken,placeholder:"https://oauth.vk.com/blank..."}),_react2["default"].createElement("div",null,"Укажите .png"),_react2["default"].createElement("div",{className:"ui input right action"},_react2["default"].createElement("input",{disabled:!state.tokenValid||state.url.length>0,ref:"file",type:"file"}),_react2["default"].createElement("button",{disabled:!state.tokenValid||state.url.length>0,"class":"ui button primary",onClick:this.handleClearFile},"Clear")),_react2["default"].createElement("div",null,"или ссылку на изображение"),_react2["default"].createElement(_input2["default"],{fluid:!0,disabled:!state.tokenValid,type:"text",value:state.url,onKeyUp:this.handleURL,placeholder:"e.g. http://i.imgur.com/cPuty2U.png"}),_react2["default"].createElement("div",null,_react2["default"].createElement("button",{className:"ui button",disabled:!state.tokenValid,onClick:this.handleLink},"Получить ссылку")),state.error&&_react2["default"].createElement("div",null,state.error),state.message&&_react2["default"].createElement("div",null,state.message),state.link&&_react2["default"].createElement("div",null,_react2["default"].createElement("a",{href:state.link},state.link))))},Graffiti}(_react.Component);exports["default"]=Graffiti},63:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _classCallCheck2=__webpack_require__(15),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(17),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(16),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(2),_react2=_interopRequireDefault(_react),_preactRouter=__webpack_require__(56),_classnames=(_interopRequireDefault(_preactRouter),__webpack_require__(18)),_classnames2=_interopRequireDefault(_classnames),Header=function(_Component){function Header(){return(0,_classCallCheck3["default"])(this,Header),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(Header,_Component),Header.prototype.render=function(props,state){return _react2["default"].createElement("div",{className:"ui secondary fixed pointing menu",style:{background:"white"}},_react2["default"].createElement("a",{className:(0,_classnames2["default"])({item:!0,active:"/"==props.currentRoute}),href:"/"},"Me"),_react2["default"].createElement("a",{className:(0,_classnames2["default"])({item:!0,active:"/graffiti"==props.currentRoute}),href:"/graffiti"},"Graffiti"))},Header}(_react.Component);exports["default"]=Header},64:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _classCallCheck2=__webpack_require__(15),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(17),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(16),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(2),_react2=_interopRequireDefault(_react),Nagisa=__webpack_require__(122),Home=function(_Component){function Home(){return(0,_classCallCheck3["default"])(this,Home),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(Home,_Component),Home.prototype.render=function(props,state){return _react2["default"].createElement("div",{className:"center-container"},_react2["default"].createElement("div",{className:"center"},_react2["default"].createElement("img",{src:Nagisa,style:{maxWidth:"100%"}}),_react2["default"].createElement("ul",{className:"links"},_react2["default"].createElement("li",null,_react2["default"].createElement("a",{href:"https://vk.com/ga2mer_o_o"},"VK")),_react2["default"].createElement("li",null,_react2["default"].createElement("a",{href:"https://twitter.com/ga2mer_ru"},"Twitter")))))},Home}(_react.Component);exports["default"]=Home}},[123]);