var _Mathmax=Math.max;(function(a){a.$fuse$=a;var d=function(f,k){if(!a.isServer){var l=f.replace(/[\.\/]+/g,'-');'-'===l.charAt(0)&&(l=l.substring(1));var m=document.getElementById(l);if(!m){var n=document.createElement(k?'style':'link');n.id=l,n.type='text/css',k?n.innerHTML=k:(n.rel='stylesheet',n.href=f),document.getElementsByTagName('head')[0].appendChild(n)}else k&&(m.innerHTML=k)}};a.on('async',function(f){return a.isServer?void 0:/\.css$/.test(f)?(d(f),!1):void 0}),a.pkg('default',{},function(f){f.file('main.js',function(k,l){'use strict';l('babel-runtime/core-js/promise').default=l('bluebird'),l('./app')}),f.file('app.jsx',function(k,l){'use strict';function p(N){return N&&N.__esModule?N:{default:N}}var q=l('antd/lib/layout'),t=p(q);l('./style/main.scss');var u=l('react'),v=p(u),z=l('react-dom'),A=l('react-router-dom'),B=l('./components/header'),C=p(B),D=l('./components/home/home.jsx'),E=p(D),F=l('./components/graffiti/graffiti.jsx'),G=p(F),H=l('./components/cover/cover.jsx'),I=p(H),J=l('./components/error/error.jsx'),K=p(J);const{Sider:L,Content:M}=t.default;(0,z.render)(v.default.createElement(A.BrowserRouter,null,v.default.createElement(t.default,{className:'layout-center'},v.default.createElement(L,{collapsible:!0},v.default.createElement(C.default,null)),v.default.createElement(t.default,null,v.default.createElement(M,null,v.default.createElement(A.Switch,null,v.default.createElement(A.Route,{path:'/',exact:!0,component:E.default}),v.default.createElement(A.Route,{path:'/graffiti',component:G.default}),v.default.createElement(A.Route,{path:'/cover',component:I.default}),v.default.createElement(A.Route,{component:K.default})))))),document.querySelector('#root'))}),f.file('style/main.scss',function(){}),f.file('components/header/index.js',function(k,l){'use strict';Object.defineProperty(k,'__esModule',{value:!0}),k.default=void 0;var q=l('./header'),t=function(u){return u&&u.__esModule?u:{default:u}}(q);k.default=t.default}),f.file('components/header/header.jsx',function(k,l){'use strict';function p(B){return B&&B.__esModule?B:{default:B}}Object.defineProperty(k,'__esModule',{value:!0});var q=l('antd/lib/menu'),t=p(q),u=l('react'),v=p(u),z=l('react-router');class A extends v.default.Component{constructor(...B){var C;return C=super(...B),this.handleClick=({key:D})=>{this.props.history.push(D)},C}render(){return v.default.createElement(t.default,{onClick:this.handleClick,theme:'dark',mode:'inline',selectedKeys:[location.pathname]},v.default.createElement(t.default.Item,{key:'/'},'Me'),v.default.createElement(t.default.Item,{key:'/graffiti'},'Graffiti'),v.default.createElement(t.default.Item,{key:'/cover'},'Cover'))}}A.propTypes={match:u.PropTypes.object.isRequired,location:u.PropTypes.object.isRequired,history:u.PropTypes.object.isRequired},k.default=(0,z.withRouter)(A)}),f.file('components/home/home.jsx',function(k,l){'use strict';function p(G){return G&&G.__esModule?G:{default:G}}Object.defineProperty(k,'__esModule',{value:!0});var t=l('antd/lib/row'),u=p(t),v=l('antd/lib/col'),z=p(v),A=l('antd/lib/menu'),B=p(A);k.default=function(){return D.default.createElement(u.default,{type:'flex',justify:'center',align:'middle',style:{minHeight:'100vh'}},D.default.createElement(z.default,null,D.default.createElement('img',{src:F.default,className:'img-fluid'}),D.default.createElement(B.default,{mode:'horizontal',className:'no-border center-horizontal',selectedKeys:[]},D.default.createElement(B.default.Item,{key:'VK'},D.default.createElement('a',{target:'_blank',href:'https://vk.com/ga2mer_o_o'},'VK')),D.default.createElement(B.default.Item,{key:'Twitter'},D.default.createElement('a',{target:'_blank',href:'https://twitter.com/ga2mer_ru'},'Twitter')))))};var C=l('react'),D=p(C),E=l('../../images/nagisa.png'),F=p(E)}),f.file('images/nagisa.png',function(k,l,m){m.exports='assets/nagisa.png'}),f.file('components/graffiti/graffiti.jsx',function(k,l){'use strict';function p(Q){return Q&&Q.__esModule?Q:{default:Q}}Object.defineProperty(k,'__esModule',{value:!0});var q=l('antd/lib/alert'),t=p(q),u=l('antd/lib/row'),v=p(u),z=l('antd/lib/button'),A=p(z),B=l('antd/lib/input'),C=p(B),D=l('antd/lib/form'),E=p(D),F=l('react'),G=p(F),H=l('classnames'),I=p(H),J=l('fetch-jsonp'),K=p(J),L=l('../../lib/VKError'),M=p(L);const N=E.default.Item,O=C.default.Group;class P extends F.Component{constructor(Q){super(Q),this.parseJSON=(R)=>R.json(),this.handleChangeToken=(R)=>{this.setState({token:R.target.value,tokenValid:/access_token=(.+)&expires_in/.test(R.target.value)})},this.handleURL=(R)=>{this.setState({url:R.target.value})},this.setInfo=(R,S)=>{this.setState({info:{type:R,message:S}})},this.handleLink=()=>{this.setInfo('','');const R=this.state.token,S=this.file;if(0==S.files.length&&0==this.state.url.length)return this.setInfo('error','\u041D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D \u0444\u0430\u0439\u043B \u0438\u043B\u0438 \u043D\u0435 \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u043E \u043F\u043E\u043B\u0435 \u044E\u0440\u043B'),!1;const[,T]=/access_token=(.+)&expires_in/.exec(R);var U=new FormData;U.append('file',S.files[0]);var V=/pu\.vk\.com\/c(\d+)\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)&api=1/i,W=/cs(\d+)\.vk\.com\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)/i;this.setInfo('info','\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F, \u043F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435'),(0,K.default)(`https://api.vk.com/method/docs.getUploadServer?v=5.54&access_token=${T}&type=graffiti`).then(this.checkStatusP).then(this.parseJSON).then((X)=>{var Y=V.test(X.response.upload_url),[,$,_,aa,ba]=(Y&&V||W).exec(X.response.upload_url);if(0<S.files.length)return fetch(`https://akg.moe/vkgraffiti/upload_by_file?c=${$}&mid=${_}&hash=${aa}&rhash=${ba}`,{method:'POST',body:U}).then(this.checkStatus).then(this.parseJSON);return this.state.url?fetch(`https://akg.moe/vkgraffiti/upload_by_url?url=${this.state.url}&c=${$}&mid=${_}&hash=${aa}&rhash=${ba}`,{method:'POST'}).then(this.checkStatus).then(this.parseJSON):void 0}).then((X)=>(0,K.default)(`https://api.vk.com/method/docs.save?v=5.54&access_token=${T}&file=${X.file}`).then(this.parseJSON)).then((X)=>{var Y=X.response[0],Z=`https://vk.com/doc${Y.owner_id}_${Y.id}`;this.setInfo('success',Z)}).catch((X)=>{return X instanceof M.default?this.setInfo('error',X.message):void this.setInfo('error',X.message)})},this.handleClearFile=()=>{this.file.value=''},this.handleCopyLink=()=>{this.linkInput.select(),document.execCommand('Copy')},this.renderAlert=()=>{return'success'==this.state.info.type?G.default.createElement(N,null,G.default.createElement(O,null,G.default.createElement(C.default,{style:{width:'64%'},type:'text',ref:(R)=>R?this.linkInput=R.refs.input:null,className:'field sharp',readOnly:!0,onClick:this.handleSelectAll,defaultValue:this.state.info.message}),G.default.createElement(A.default,{type:'primary',size:'large',className:'button-left-sharp',onClick:this.handleCopyLink},'\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C'))):G.default.createElement('div',{className:'text-center'},this.state.info.message)},this.renderLabelText=(R)=>G.default.createElement('div',{className:'text-center'},R),this.state={token:'',tokenValid:!1,url:'',info:{type:'',message:''}}}checkStatus(Q){return 200<=Q.status&&300>Q.status?Q:Q.json().then((R)=>{var S;if(R.message)S='File too large'==R.message&&'\u0420\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0435\u0442 4\u043C\u0431'||R.message;else if(R.error&&R.error.error_code)return Promise.reject(new M.default(R.error.error_msg,R.error.error_code));return Promise.reject(new Error(S))})}checkStatusP(Q){return Q.json().then((R)=>{if(R.response)return Q;return R.error&&R.error.error_code?Promise.reject(new M.default(R.error.error_msg,R.error.error_code)):R.error?Promise.reject(new Error(R.error.error_msg)):void 0})}handleGetToken(){window.open('https://oauth.vk.com/authorize?client_id=5553668&scope=docs&response_type=token')}handleSelectAll(Q){Q.target.setSelectionRange(0,Q.target.value.length)}render(){return G.default.createElement(v.default,{type:'flex',justify:'center',align:'middle',style:{minHeight:'100vh'}},G.default.createElement('div',null,G.default.createElement('div',{className:'text-center'},'\u0417\u0434\u0435\u0441\u044C \u043A\u043E\u0433\u0434\u0430-\u043D\u0438\u0431\u0443\u0434\u044C \u0431\u0443\u0434\u0435\u0442 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435'),G.default.createElement('div',null,G.default.createElement(E.default,{layout:'vertical',className:'form-nopadding'},G.default.createElement(N,{label:this.renderLabelText('\u0410\u0434\u0440\u0435\u0441 \u0441 access_token')},G.default.createElement(O,null,G.default.createElement(C.default,{style:{width:'70%'},type:'text',className:'field',value:this.state.token,onChange:this.handleChangeToken,placeholder:'https://oauth.vk.com/blank...'}),G.default.createElement(A.default,{type:'primary',size:'large',className:'button-left-sharp',onClick:this.handleGetToken},'\u041F\u043E\u043B\u0443\u0447\u0438\u0442\u044C'))),G.default.createElement(N,{label:this.renderLabelText('\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435: png, jpg \u0438\u043B\u0438 gif')},G.default.createElement(O,null,G.default.createElement(C.default,{style:{width:'70%',height:'100%'},id:'file',className:'field',disabled:!this.state.tokenValid||0<this.state.url.length,ref:(Q)=>Q?this.file=Q.refs.input:null,type:'file'}),G.default.createElement(A.default,{type:'primary',size:'large',className:'button-left-sharp wat',disabled:!this.state.tokenValid||0<this.state.url.length,onClick:this.handleClearFile},'\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C'))),G.default.createElement('div',{className:'strike'},G.default.createElement('span',null,'\u0438\u043B\u0438 \u0441\u0441\u044B\u043B\u043A\u0443 \u043D\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435')),G.default.createElement(N,null,G.default.createElement(C.default,{className:'sharp',disabled:!this.state.tokenValid,type:'text',value:this.state.url,onChange:this.handleURL,placeholder:'e.g. http://i.imgur.com/cPuty2U.png'})),G.default.createElement('div',{className:'divider'}),G.default.createElement(v.default,{type:'flex',justify:'center'},G.default.createElement(A.default,{disabled:!this.state.tokenValid,onClick:this.handleLink},'\u041F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u0441\u044B\u043B\u043A\u0443')),this.state.info.type&&G.default.createElement('div',{className:'divider'}),this.state.info.type&&G.default.createElement(t.default,{className:'alert-center',message:this.renderAlert(),type:this.state.info.type})))))}}k.default=P}),f.file('lib/VKError.js',function(k){'use strict';Object.defineProperty(k,'__esModule',{value:!0});class p extends Error{constructor(q,t){super(),this.name='VKError',this.message=q,this.error_code=t,this.stack=new Error().stack}}k.default=p}),f.file('components/cover/cover.jsx',function(k,l){'use strict';function p(P){return P&&P.__esModule?P:{default:P}}Object.defineProperty(k,'__esModule',{value:!0});var q=l('antd/lib/button'),t=p(q),u=l('antd/lib/input'),v=p(u),z=l('antd/lib/row'),A=p(z),B=l('antd/lib/col'),C=p(B),D=l('antd/lib/form'),E=p(D),F=l('react'),G=p(F),H=l('react-cropper'),I=p(H),J=l('file-saver'),K=l('../../images/lossy_v2.png'),L=p(K);l('../../lib/blur_rect');const M=E.default.Item;class N extends F.Component{constructor(...P){var Q;return Q=super(...P),this.x=0,this.y=0,this.width=0,this.height=0,this.text='',this.fileLoaded=!1,this.blobs=[],this.initCanvas=()=>{this.ctx=this.canvas.getContext('2d')},this.initCover=()=>{this.cover=new Image,this.cover.onload=()=>{this.ctx.drawImage(this.cover,0,323,500,177),this.fileLoaded&&this.renderCover()},this.cover.src=L.default},this.onCrop=(R)=>{this.x=R.detail.x,this.y=R.detail.y,this.width=R.detail.width,this.height=R.detail.height,this.renderCover()},this.handleFile=(R)=>{if(0<R.target.files.length){let S=URL.createObjectURL(R.target.files[0]);this.blobs.push(S),this.img=document.createElement('img'),this.img.onload=()=>{this.cropper.reset().replace(S),this.fileLoaded=!0},this.img.src=S}},this.handleText=(R)=>{this.text=R.target.value,this.renderCover()},this.handleSave=()=>{let R=document.createElement('canvas');R.width=800,R.height=800;let S=R.getContext('2d');S.drawImage(this.img,this.x,this.y,this.width,this.height,0,0,800,800),S._blurRect(0,704,616,96,1,2),S._blurRect(671,652,129,148,1,2),S.drawImage(this.cover,0,517,800,283),S.font='42px MuseoBlack',S.fillStyle='#2d2d2d',S.fillText(this.text,34,764),R.toBlob((T)=>{(0,J.saveAs)(T,'cover.png')})},Q}componentDidMount(){this.initCanvas(),this.initCover()}componentWillUnmount(){this.blobs.forEach((P)=>{URL.revokeObjectURL(P)})}renderCover(){this.ctx.clearRect(0,0,500,500),this.ctx.drawImage(this.img,this.x,this.y,this.width,this.height,0,0,500,500),this.ctx._blurRect(0,439,400,61,1,2),this.ctx._blurRect(419,404,70,80,1,2),this.ctx.drawImage(this.cover,0,323,500,177),this.ctx.font='32px MuseoBlack',this.ctx.fillStyle='#2d2d2d',this.ctx.fillText(this.text,14,480)}render(){return G.default.createElement(A.default,{type:'flex',justify:'center',align:'middle',style:{minHeight:'100vh'}},G.default.createElement('div',{className:'container-fluid'},G.default.createElement(A.default,{gutter:32},G.default.createElement(C.default,{span:12,className:'cover'},G.default.createElement('canvas',{ref:(P)=>this.canvas=P,id:'canvas',width:'500',height:'500'})),G.default.createElement(C.default,{span:12},G.default.createElement(I.default,{className:'cropper',ref:(P)=>this.cropper=P,aspectRatio:1,dragMode:'move',viewMode:1,zoomable:!1,guides:!1,crop:this.onCrop}))),G.default.createElement(A.default,{type:'flex',justify:'center'},G.default.createElement(O,{onFile:this.handleFile,onText:this.handleText,onSave:this.handleSave}))))}}k.default=N;class O extends F.Component{constructor(P){super(P),this.handleFile=(Q)=>{0<Q.target.files.length&&(this.setState({fileLoaded:!0}),this.props.onFile(Q))},this.handleText=(Q)=>{this.props.onText(Q)},this.handleSave=()=>{this.props.onSave()},this.state={fileLoaded:!1}}componentDidMount(){this.file.addEventListener('change',this.handleFile)}render(){return G.default.createElement(E.default,{className:'output form-cover'},G.default.createElement(M,null,G.default.createElement(v.default,{style:{height:'100%'},type:'file',ref:(P)=>P?this.file=P.refs.input:null,className:'sharp',addonAfter:'\u041E\u0431\u043B\u043E\u0436\u043A\u0430'})),G.default.createElement(M,null,G.default.createElement(v.default,{type:'text',id:'name',placeholder:'\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0442\u0438\u043F',className:'sharp','aria-describedby':'basic-addon2',disabled:!this.state.fileLoaded,onChange:this.handleText,addonAfter:'\u0422\u0438\u043F \u0430\u043B\u044C\u0431\u043E\u043C\u0430'})),G.default.createElement(M,null,G.default.createElement(A.default,{type:'flex',justify:'center'},G.default.createElement(t.default,{disabled:!this.state.fileLoaded,onClick:this.handleSave},'\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C'))))}}}),f.file('images/lossy_v2.png',function(k,l,m){m.exports='assets/lossy_v2.png'}),f.file('lib/blur_rect.js',function(){'use strict';!function(p){'use strict';function q(E,F,G,H){var J,K,L,M,N=0.3086*(1-H),O=0.6094*(1-H),P=0.082*(1-H),Q,R,S;for(L=0;L<G;L++)for(M=L*(F<<2),K=0;K<F;K++)J=M+(K<<2),Q=E[J],R=E[J+1],S=E[J+2],E[J]=(N+H)*Q+O*R+P*S,E[J+1]=N*Q+(O+H)*R+P*S,E[J+2]=N*Q+O*R+(P+H)*S}function t(E,F,G,H,I){var J=new Uint8Array(4*(F*G));u(E,J,F,G,H),z(J,E,F,G,H),v(E,J,F,G,H),A(J,E,F,G,H),I!==void 0&&1!==I&&q(E,F,G,I)}function u(E,F,G,H,I){var J,K,L,M,N,Q,R,S,T;for(K=0;K<H;K++){for(Q=0,R=0,S=0,T=0,L=K*(G<<2),J=0;J<I;J++)M=L+(J<<2),Q+=E[M],R+=E[M+1],S+=E[M+2],T+=E[M+3],F[M]=0|Q/(J+1),F[M+1]=0|R/(J+1),F[M+2]=0|S/(J+1),F[M+3]=0|T/(J+1);for(;J<G;J++)M=L+(J<<2),N=M-(I<<2),F[M]=0|Q/I,F[M+1]=0|R/I,F[M+2]=0|S/I,F[M+3]=0|T/I,Q+=E[M]-E[N],R+=E[M+1]-E[N+1],S+=E[M+2]-E[N+2],T+=E[M+3]-E[N+3]}}function v(E,F,G,H,I){var J,K,L,M,N,Q,R,S,T;for(K=0;K<H;K++){for(Q=0,R=0,S=0,T=0,L=K*(G<<2),J=G-1;J>=G-I;J--)M=L+(J<<2),Q+=E[M],R+=E[M+1],S+=E[M+2],T+=E[M+3],F[M]=0|Q/(G-J),F[M+1]=0|R/(G-J),F[M+2]=0|S/(G-J),F[M+3]=0|T/(G-J);for(;0<=J;J--)M=L+(J<<2),N=M+(I<<2),F[M]=0|Q/I,F[M+1]=0|R/I,F[M+2]=0|S/I,F[M+3]=0|T/I,Q+=E[M]-E[N],R+=E[M+1]-E[N+1],S+=E[M+2]-E[N+2],T+=E[M+3]-E[N+3]}}function z(E,F,G,H,I){var J,K,L,M,N,P=G<<2,R,S,T,U;for(J=0;J<G;J++){for(R=0,S=0,T=0,U=0,L=J<<2,K=0;K<I;K++)M=L+K*P,R+=E[M],S+=E[M+1],T+=E[M+2],U+=E[M+3],F[M]=0|R/(K+1),F[M+1]=0|S/(K+1),F[M+2]=0|T/(K+1),F[M+3]=0|U/(K+1);for(;K<H;K++)M=L+K*P,N=M-P*I,F[M]=0|R/I,F[M+1]=0|S/I,F[M+2]=0|T/I,F[M+3]=0|U/I,R+=E[M]-E[N],S+=E[M+1]-E[N+1],T+=E[M+2]-E[N+2],U+=E[M+3]-E[N+3]}}function A(E,F,G,H,I){var J,K,L,M,N,P=G<<2,R,S,T,U;for(J=0;J<G;J++){for(R=0,S=0,T=0,U=0,L=J<<2,K=H-1;K>=H-I;K--)M=L+K*P,R+=E[M],S+=E[M+1],T+=E[M+2],U+=E[M+3],F[M]=0|R/(H-K),F[M+1]=0|S/(H-K),F[M+2]=0|T/(H-K),F[M+3]=0|U/(H-K);for(;0<=K;K--)M=L+K*P,N=M+P*I,F[M]=0|R/I,F[M+1]=0|S/I,F[M+2]=0|T/I,F[M+3]=0|U/I,R+=E[M]-E[N],S+=E[M+1]-E[N+1],T+=E[M+2]-E[N+2],U+=E[M+3]-E[N+3]}}var C=document.createElement('canvas');C.width=screen.width,C.height=screen.height;var D=C.getContext('2d');p.CanvasRenderingContext2D.prototype._blurRect=function(E,F,G,H,I,J){var K=this,L=K.canvas,M=0|G,N=0|H,O=0|E,P=0|F;I=32*(0|I),I=Math.min(_Mathmax(I,32),256);var Q=_Mathmax(0,0|Math.log(I)/0.6931471805599453-3),R=I>>>Q,S=L.width>>>Q,T=L.height>>>Q;D.drawImage(L,0,0,S,T);var U=D.getImageData(0,0,S,T);return t(U.data,S,T,R,J),D.putImageData(U,0,0),D.drawImage(C,0,0,S,T,0,0,L.width,L.height),K.drawImage(C,O,P,M,N,O,P,M,N),K}}(window)}),f.file('components/error/error.jsx',function(k,l){'use strict';function p(C){return C&&C.__esModule?C:{default:C}}Object.defineProperty(k,'__esModule',{value:!0});var t=l('antd/lib/row'),u=p(t);k.default=function(){return z.default.createElement(u.default,{type:'flex',justify:'center',align:'middle',style:{minHeight:'100vh'}},z.default.createElement('img',{src:B.default,className:'img-fluid'}))};var v=l('react'),z=p(v),A=l('../../images/ram.png'),B=p(A)}),f.file('images/ram.png',function(k,l,m){m.exports='assets/ram.png'})}),a.import('default/main.js'),a.main('default/main.js')})(FuseBox);