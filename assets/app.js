webpackJsonp([0],{176:function(module,exports,__webpack_require__){"use strict";(function(global){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function Error(){return _react2["default"].createElement("div",null,"404")}var _classCallCheck2=__webpack_require__(48),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(50),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(49),_inherits3=_interopRequireDefault(_inherits2);__webpack_require__(228);var _react=__webpack_require__(4),_react2=_interopRequireDefault(_react),_reactDom=__webpack_require__(251),_reactDom2=_interopRequireDefault(_reactDom),_reactRouter=__webpack_require__(141),_header=__webpack_require__(178),_header2=_interopRequireDefault(_header),_home=__webpack_require__(179),_home2=_interopRequireDefault(_home),_graffiti=__webpack_require__(177),_graffiti2=_interopRequireDefault(_graffiti);global.Promise=__webpack_require__(185);var App=function(_React$Component){function App(props){(0,_classCallCheck3["default"])(this,App);var _this=(0,_possibleConstructorReturn3["default"])(this,_React$Component.call(this,props));return _this.state={currentRoute:"/"},_this.handleRoute=_this.handleRoute.bind(_this),_this}return(0,_inherits3["default"])(App,_React$Component),App.prototype.handleRoute=function(e){console.log(e),this.setState({currentRoute:e.url})},App.prototype.render=function(){return _react2["default"].createElement("div",{className:"app"},_react2["default"].createElement(_header2["default"],{currentRoute:this.props.location.pathname}),this.props.children)},App}(_react2["default"].Component);_reactDom2["default"].render(_react2["default"].createElement(_reactRouter.Router,{history:_reactRouter.browserHistory},_react2["default"].createElement(_reactRouter.Route,{path:"/",component:App},_react2["default"].createElement(_reactRouter.IndexRoute,{component:_home2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"graffiti",component:_graffiti2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"*",component:Error}))),document.querySelector("#root"))}).call(exports,__webpack_require__(175))},177:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _promise=__webpack_require__(182),_promise2=_interopRequireDefault(_promise),_classCallCheck2=__webpack_require__(48),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(50),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(49),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(4),_react2=_interopRequireDefault(_react),_input=__webpack_require__(344),_input2=_interopRequireDefault(_input),_fetchJsonp=__webpack_require__(244),_fetchJsonp2=_interopRequireDefault(_fetchJsonp),Graffiti=function(_Component){function Graffiti(){(0,_classCallCheck3["default"])(this,Graffiti);var _this=(0,_possibleConstructorReturn3["default"])(this,_Component.call(this));return _this.state={token:"",tokenValid:!1,url:"",error:"",link:"",message:""},_this.handleChangeToken=_this.handleChangeToken.bind(_this),_this.handleURL=_this.handleURL.bind(_this),_this.handleLink=_this.handleLink.bind(_this),_this.parseJSON=_this.parseJSON.bind(_this),_this.checkStatus=_this.checkStatus.bind(_this),_this.handleClearFile=_this.handleClearFile.bind(_this),_this}return(0,_inherits3["default"])(Graffiti,_Component),Graffiti.prototype.checkStatus=function(response){return response.status>=200&&response.status<300?response:response.json().then(function(json){var message;return json.message?message="File too large"==json.message&&"Размер файла превышает 4мб"||json.message:json.error&&5==json.error.error_code&&(message="Токен неправильный или устарел"),_promise2["default"].reject(new Error(message))})},Graffiti.prototype.checkStatusP=function(response){return response.json().then(function(json){if(json.response)return response;if(json.error&&5==json.error.error_code){var message="Токен неправильный или устарел";return _promise2["default"].reject(new Error(message))}return json.error?_promise2["default"].reject(new Error(json.error.error_msg)):void 0})},Graffiti.prototype.parseJSON=function(response){return response.json()},Graffiti.prototype.handleGetToken=function(){window.open("https://oauth.vk.com/authorize?client_id=5553668&scope=docs&response_type=token")},Graffiti.prototype.handleChangeToken=function(e){this.setState({token:e.target.value,tokenValid:/access_token=(.+)&expires_in/.test(e.target.value)})},Graffiti.prototype.handleURL=function(e){this.setState({url:e.target.value})},Graffiti.prototype.handleLink=function(){var _this2=this;this.setState({error:"",message:"",link:""});var tokenEl=this.state.token,fileEl=this.file;if(0==fileEl.files.length&&0==this.state.url.length)return this.setState({error:"Не выбран файл или не заполнено поле юрл"}),!1;var _$exec=/access_token=(.+)&expires_in/.exec(tokenEl),token=_$exec[1],fd=new FormData;fd.append("file",fileEl.files[0]);var regexHttps=/pu\.vk\.com\/c(\d+)\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)&api=1/i,regexHttp=/cs(\d+)\.vk\.com\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)/i;(0,_fetchJsonp2["default"])("https://api.vk.com/method/docs.getUploadServer?v=5.54&access_token="+token+"&type=graffiti").then(this.checkStatusP).then(this.parseJSON).then(function(uploadServer){_this2.setState({message:"Загрузка изображения, подождите"});var isHTTPS=regexHttps.test(uploadServer.response.upload_url),regex=isHTTPS&&regexHttps||regexHttp,_regex$exec=regex.exec(uploadServer.response.upload_url),c=_regex$exec[1],mid=_regex$exec[2],hash=_regex$exec[3],rhash=_regex$exec[4];return fileEl.files.length>0?fetch("https://akigami.ru/vkgraffiti/upload_by_file?c="+c+"&mid="+mid+"&hash="+hash+"&rhash="+rhash,{method:"POST",body:fd}).then(_this2.checkStatus).then(_this2.parseJSON):_this2.state.url?fetch("https://akigami.ru/vkgraffiti/upload_by_url?url="+_this2.state.url+"&c="+c+"&mid="+mid+"&hash="+hash+"&rhash="+rhash,{method:"POST"}).then(_this2.checkStatus).then(_this2.parseJSON):void 0}).then(function(responseFile){return(0,_fetchJsonp2["default"])("https://api.vk.com/method/docs.save?v=5.54&access_token="+token+"&file="+responseFile.file).then(_this2.parseJSON)}).then(function(responseDoc){var doc=responseDoc.response[0],link="https://vk.com/doc"+doc.owner_id+"_"+doc.id;_this2.setState({link:link,err:"",message:""})})["catch"](function(err){_this2.setState({error:err.message,link:"",message:""})})},Graffiti.prototype.handleClearFile=function(){this.file.value=""},Graffiti.prototype.render=function(){var _this3=this;return _react2["default"].createElement("div",{className:"center-container"},_react2["default"].createElement("div",{className:"center"},_react2["default"].createElement("button",{className:"ui button",onClick:this.handleGetToken},"Получить токен"),_react2["default"].createElement("div",null,"Вставьте полностью весь юрл"),_react2["default"].createElement(_input2["default"],{type:"text",fluid:!0,value:this.state.token,onChange:this.handleChangeToken,placeholder:"https://oauth.vk.com/blank..."}),_react2["default"].createElement("div",null,"Укажите .png"),_react2["default"].createElement("div",{className:"ui input right action"},_react2["default"].createElement("input",{disabled:!this.state.tokenValid||this.state.url.length>0,ref:function(c){return _this3.file=c},type:"file"}),_react2["default"].createElement("button",{disabled:!this.state.tokenValid||this.state.url.length>0,className:"ui button primary",onClick:this.handleClearFile},"Clear")),_react2["default"].createElement("div",null,"или ссылку на изображение"),_react2["default"].createElement(_input2["default"],{fluid:!0,disabled:!this.state.tokenValid,type:"text",value:this.state.url,onKeyUp:this.handleURL,placeholder:"e.g. http://i.imgur.com/cPuty2U.png"}),_react2["default"].createElement("div",null,_react2["default"].createElement("button",{className:"ui button",disabled:!this.state.tokenValid,onClick:this.handleLink},"Получить ссылку")),this.state.error&&_react2["default"].createElement("div",null,this.state.error),this.state.message&&_react2["default"].createElement("div",null,this.state.message),this.state.link&&_react2["default"].createElement("div",null,_react2["default"].createElement("a",{href:this.state.link},this.state.link))))},Graffiti}(_react.Component);exports["default"]=Graffiti},178:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _classCallCheck2=__webpack_require__(48),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(50),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(49),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(4),_react2=_interopRequireDefault(_react),_reactRouter=__webpack_require__(141),_classnames=__webpack_require__(51),_classnames2=_interopRequireDefault(_classnames),Header=function(_Component){function Header(){return(0,_classCallCheck3["default"])(this,Header),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(Header,_Component),Header.prototype.render=function(){return _react2["default"].createElement("div",{className:"ui secondary fixed pointing menu",style:{background:"white"}},_react2["default"].createElement(_reactRouter.Link,{className:(0,_classnames2["default"])({item:!0,active:"/"==this.props.currentRoute}),to:"/"},"Me"),_react2["default"].createElement(_reactRouter.Link,{className:(0,_classnames2["default"])({item:!0,active:"/graffiti"==this.props.currentRoute}),to:"/graffiti"},"Graffiti"))},Header}(_react.Component);exports["default"]=Header},179:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _classCallCheck2=__webpack_require__(48),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(50),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(49),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(4),_react2=_interopRequireDefault(_react),Nagisa=__webpack_require__(347),Home=function(_Component){function Home(){return(0,_classCallCheck3["default"])(this,Home),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(Home,_Component),Home.prototype.render=function(){return _react2["default"].createElement("div",{className:"center-container"},_react2["default"].createElement("div",{className:"center"},_react2["default"].createElement("img",{src:Nagisa,style:{maxWidth:"100%"}}),_react2["default"].createElement("ul",{className:"links"},_react2["default"].createElement("li",null,_react2["default"].createElement("a",{href:"https://vk.com/ga2mer_o_o"},"VK")),_react2["default"].createElement("li",null,_react2["default"].createElement("a",{href:"https://twitter.com/ga2mer_ru"},"Twitter")))))},Home}(_react.Component);exports["default"]=Home},228:function(module,exports){},347:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"601aa39318bb5d828cac1b4bdc49f6f1.png"},348:function(module,exports,__webpack_require__){module.exports=__webpack_require__(176)}},[348]);