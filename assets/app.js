webpackJsonp([0],{114:function(e,t){},133:function(e,t,a){e.exports=a.p+"lossy_v2.png"},134:function(e,t,a){e.exports=a.p+"nagisa.png"},135:function(e,t,a){e.exports=a.p+"ram.png"},139:function(e,t,a){e.exports=a(60)},60:function(e,t,a){a(38).default=a(73),a(61)},61:function(e,t,a){"use strict";function n(e){var t=e.children;return i.a.createElement("div",{className:"app"},i.a.createElement(m.a,null)," ",t)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(114),o=(a.n(r),a(3)),i=a.n(o),c=a(3),s=(a.n(c),a(57)),l=(a.n(s),a(120)),d=a.n(l),m=a(65),u=a(66),h=a(64),f=a(62),p=a(63),v=d()();a.i(c.render)(i.a.createElement(s.Router,{history:v},i.a.createElement(s.Route,{component:n},i.a.createElement(s.IndexRoute,{component:u.a}),i.a.createElement(s.Route,{path:"graffiti",component:h.a}),i.a.createElement(s.Route,{path:"cover",component:f.a}),i.a.createElement(s.Route,{path:"*",component:p.a}))),document.querySelector("#root"))},62:function(e,t,a){"use strict";var n=a(22),r=a.n(n),o=a(24),i=a.n(o),c=a(23),s=a.n(c),l=a(3),d=a.n(l),m=a(129),u=a.n(m),h=a(116),f=(a.n(h),a(133)),p=a.n(f),v=a(68),g=(a.n(v),function(e){function t(){var n,o,c;r()(this,t);for(var s=arguments.length,l=Array(s),d=0;d<s;d++)l[d]=arguments[d];return n=o=i()(this,e.call.apply(e,[this].concat(l))),o.x=0,o.y=0,o.width=0,o.height=0,o.text="",o.fileLoaded=!1,o.blobs=[],o.initCanvas=function(){o.ctx=o.canvas.getContext("2d")},o.initCover=function(){o.cover=new Image,o.cover.onload=function(){o.ctx.drawImage(o.cover,0,323,500,177),o.fileLoaded&&o.renderCover()},o.cover.src=p.a},o.onCrop=function(e){o.x=e.detail.x,o.y=e.detail.y,o.width=e.detail.width,o.height=e.detail.height,o.renderCover()},o.handleFile=function(e){e.target.files.length>0&&!function(){var t=URL.createObjectURL(e.target.files[0]);o.blobs.push(t),o.img=document.createElement("img"),o.img.onload=function(){o.cropper.reset().replace(t),o.fileLoaded=!0},o.img.src=t}()},o.handleText=function(e){o.text=e.target.value,o.renderCover()},o.handleSave=function(){var e=document.createElement("canvas");e.width=800,e.height=800;var t=e.getContext("2d");t.drawImage(o.img,o.x,o.y,o.width,o.height,0,0,800,800),t._blurRect(0,704,616,96,1,2),t._blurRect(671,652,129,148,1,2),t.drawImage(o.cover,0,517,800,283),t.font="42px MuseoBlack",t.fillStyle="#2d2d2d",t.fillText(o.text,34,764),e.toBlob(function(e){a.i(h.saveAs)(e,"cover.png")})},c=n,i()(o,c)}return s()(t,e),t.prototype.componentDidMount=function(){this.initCanvas(),this.initCover()},t.prototype.componentWillUnmount=function(){this.blobs.forEach(function(e){URL.revokeObjectURL(e)})},t.prototype.renderCover=function(){this.ctx.clearRect(0,0,500,500),this.ctx.drawImage(this.img,this.x,this.y,this.width,this.height,0,0,500,500),this.ctx._blurRect(0,439,400,61,1,2),this.ctx._blurRect(419,404,70,80,1,2),this.ctx.drawImage(this.cover,0,323,500,177),this.ctx.font="32px MuseoBlack",this.ctx.fillStyle="#2d2d2d",this.ctx.fillText(this.text,14,480)},t.prototype.render=function(){var e=this;return d.a.createElement("div",{className:"vertical-center"},d.a.createElement("div",{className:"container-fluid"},d.a.createElement("div",{className:"row around-xs"},d.a.createElement("div",{className:"col-xs"},d.a.createElement("div",{className:"cover"},d.a.createElement("canvas",{ref:function(t){return e.canvas=t},id:"canvas",width:"500",height:"500"}))),d.a.createElement("div",{className:"col-xs"},d.a.createElement(u.a,{className:"cropper",ref:function(t){return e.cropper=t},aspectRatio:1,dragMode:"move",viewMode:1,zoomable:!1,guides:!1,crop:this.onCrop}))),d.a.createElement("div",{className:"row center-text"},d.a.createElement(E,{onFile:this.handleFile,onText:this.handleText,onSave:this.handleSave}))))},t}(l.Component));t.a=g;var E=function(e){function t(a){r()(this,t);var n=i()(this,e.call(this,a));return n.handleFile=function(e){e.target.files.length>0&&(n.setState({fileLoaded:!0}),n.props.onFile(e))},n.handleText=function(e){n.props.onText(e)},n.handleSave=function(){n.props.onSave()},n.state={fileLoaded:!1},n}return s()(t,e),t.prototype.componentDidMount=function(){this.file.addEventListener("change",this.handleFile)},t.prototype.render=function(){var e=this;return d.a.createElement("div",{className:"output"},d.a.createElement("div",{className:"form-control"},d.a.createElement("input",{type:"file",id:"file",className:"field","aria-describedby":"basic-addon2",ref:function(t){return e.file=t}}),d.a.createElement("span",{className:"item",id:"basic-addon2"},"Обложка")),d.a.createElement("div",{className:"form-control"},d.a.createElement("input",{type:"text",id:"name",placeholder:"Укажите тип",className:"field","aria-describedby":"basic-addon2",disabled:!this.state.fileLoaded,onChange:this.handleText}),d.a.createElement("span",{className:"item",id:"basic-addon2"},"Тип альбома")),d.a.createElement("button",{type:"button",className:"btn",disabled:!this.state.fileLoaded,onClick:this.handleSave},"Сохранить"))},t}(l.Component)},63:function(e,t,a){"use strict";function n(){return o.a.createElement("div",{className:"container center-text",style:{maxWidth:"450px"}},o.a.createElement("img",{src:c.a,className:"img-fluid"}))}var r=a(3),o=a.n(r),i=a(135),c=a.n(i);t.a=n},64:function(e,t,a){"use strict";var n=a(38),r=a.n(n),o=a(22),i=a.n(o),c=a(24),s=a.n(c),l=a(23),d=a.n(l),m=a(3),u=a.n(m),h=a(40),f=a.n(h),p=a(115),v=a.n(p),g=a(67),E=function(e){function t(a){i()(this,t);var n=s()(this,e.call(this,a));return n.parseJSON=function(e){return e.json()},n.handleChangeToken=function(e){n.setState({token:e.target.value,tokenValid:/access_token=(.+)&expires_in/.test(e.target.value)})},n.handleURL=function(e){n.setState({url:e.target.value})},n.setInfo=function(e,t){n.setState({info:{type:e,message:t}})},n.handleLink=function(){n.setInfo("","");var e=n.state.token,t=n.file;if(0==t.files.length&&0==n.state.url.length)return n.setInfo("error","Не выбран файл или не заполнено поле юрл"),!1;var a=/access_token=(.+)&expires_in/.exec(e),r=a[1],o=new FormData;o.append("file",t.files[0]);var i=/pu\.vk\.com\/c(\d+)\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)&api=1/i,c=/cs(\d+)\.vk\.com\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)/i;n.setInfo("message","Загрузка изображения, подождите"),v()("https://api.vk.com/method/docs.getUploadServer?v=5.54&access_token="+r+"&type=graffiti").then(n.checkStatusP).then(n.parseJSON).then(function(e){var a=i.test(e.response.upload_url),r=a&&i||c,s=r.exec(e.response.upload_url),l=s[1],d=s[2],m=s[3],u=s[4];return t.files.length>0?fetch("https://akg.moe/vkgraffiti/upload_by_file?c="+l+"&mid="+d+"&hash="+m+"&rhash="+u,{method:"POST",body:o}).then(n.checkStatus).then(n.parseJSON):n.state.url?fetch("https://akg.moe/vkgraffiti/upload_by_url?url="+n.state.url+"&c="+l+"&mid="+d+"&hash="+m+"&rhash="+u,{method:"POST"}).then(n.checkStatus).then(n.parseJSON):void 0}).then(function(e){return v()("https://api.vk.com/method/docs.save?v=5.54&access_token="+r+"&file="+e.file).then(n.parseJSON)}).then(function(e){var t=e.response[0],a="https://vk.com/doc"+t.owner_id+"_"+t.id;n.setInfo("link",a)}).catch(function(e){return e instanceof g.a?n.setInfo("error",e.message):void n.setInfo("error",e.message)})},n.handleClearFile=function(){n.file.value=""},n.handleCopyLink=function(){n.linkInput.select(),document.execCommand("Copy")},n.state={token:"",tokenValid:!1,url:"",info:{type:"",message:""}},n}return d()(t,e),t.prototype.checkStatus=function(e){return e.status>=200&&e.status<300?e:e.json().then(function(e){var t;if(e.message)t="File too large"==e.message&&"Размер файла превышает 4мб"||e.message;else if(e.error&&e.error.error_code)return r.a.reject(new g.a(e.error.error_msg,e.error.error_code));return r.a.reject(new Error(t))})},t.prototype.checkStatusP=function(e){return e.json().then(function(t){return t.response?e:t.error&&t.error.error_code?r.a.reject(new g.a(t.error.error_msg,t.error.error_code)):t.error?r.a.reject(new Error(t.error.error_msg)):void 0})},t.prototype.handleGetToken=function(){window.open("https://oauth.vk.com/authorize?client_id=5553668&scope=docs&response_type=token")},t.prototype.handleSelectAll=function(e){e.target.setSelectionRange(0,e.target.value.length)},t.prototype.render=function(){var e=this;return u.a.createElement("div",{className:"vertical-center center-text"},u.a.createElement("div",{style:{maxWidth:"450px"}},"Здесь когда-нибудь будет описание",u.a.createElement("form",null,u.a.createElement("label",{htmlFor:"token"},"Адрес с access_token"),u.a.createElement("div",{className:"form-control"},u.a.createElement("input",{id:"token",type:"text",className:"field",value:this.state.token,onChange:this.handleChangeToken,placeholder:"https://oauth.vk.com/blank..."}),u.a.createElement("button",{className:"item primary",type:"button",onClick:this.handleGetToken},"Получить")),u.a.createElement("label",{htmlFor:"file"},"Изображение в формате: png, jpg или gif"),u.a.createElement("div",{className:"form-control"},u.a.createElement("input",{id:"file",className:"field",disabled:!this.state.tokenValid||this.state.url.length>0,ref:function(t){return e.file=t},type:"file"}),u.a.createElement("button",{className:"item primary",type:"button",disabled:!this.state.tokenValid||this.state.url.length>0,onClick:this.handleClearFile},"Очистить")),u.a.createElement("div",{className:"strike"},u.a.createElement("span",null,"или ссылку на изображение")),u.a.createElement("div",{className:"form-control"},u.a.createElement("input",{className:"field sharp",disabled:!this.state.tokenValid,type:"text",value:this.state.url,onChange:this.handleURL,placeholder:"e.g. http://i.imgur.com/cPuty2U.png"})),u.a.createElement("div",{className:"divider"}),u.a.createElement("button",{className:"btn secondary",type:"button",disabled:!this.state.tokenValid,onClick:this.handleLink},"Получить ссылку"),this.state.info.type&&u.a.createElement("div",{className:"divider"}),this.state.info.type&&u.a.createElement("div",{className:f()({alert:!0,"alert-danger":"error"==this.state.info.type,"alert-info":"message"==this.state.info.type,"alert-success":"link"==this.state.info.type}),role:"alert"},function(){return"link"==e.state.info.type?u.a.createElement("div",{className:"form-control"},u.a.createElement("input",{type:"text",ref:function(t){return e.linkInput=t},className:"field sharp",readOnly:!0,onClick:e.handleSelectAll,defaultValue:e.state.info.message}),u.a.createElement("button",{className:"item primary",type:"button",onClick:e.handleCopyLink},"Скопировать")):e.state.info.message}()))))},t}(m.Component);t.a=E},65:function(e,t,a){"use strict";function n(){return o.a.createElement("header",{style:{background:"white"}},o.a.createElement("ul",{className:"navigation"},o.a.createElement("li",{className:s()({active:"/"==location.pathname})},o.a.createElement(i.Link,{to:"/"},"Me")),o.a.createElement("li",{className:s()({active:"/graffiti"==location.pathname})},o.a.createElement(i.Link,{to:"/graffiti"},"Graffiti")),o.a.createElement("li",{className:s()({active:"/cover"==location.pathname})},o.a.createElement(i.Link,{to:"/cover"},"Cover"))))}var r=a(3),o=a.n(r),i=a(57),c=(a.n(i),a(40)),s=a.n(c);t.a=n},66:function(e,t,a){"use strict";function n(){return o.a.createElement("div",{className:"vertical-center"},o.a.createElement("div",{className:"container center-text"},o.a.createElement("img",{src:c.a,className:"img-fluid"}),o.a.createElement("ul",{className:"links"},o.a.createElement("li",null,o.a.createElement("a",{href:"https://vk.com/ga2mer_o_o"},"VK")),o.a.createElement("li",null,o.a.createElement("a",{href:"https://twitter.com/ga2mer_ru"},"Twitter")))))}var r=a(3),o=a.n(r),i=a(134),c=a.n(i);t.a=n},67:function(e,t,a){"use strict";var n=a(22),r=a.n(n),o=a(24),i=a.n(o),c=a(23),s=a.n(c),l=function(e){function t(a,n){r()(this,t);var o=i()(this,e.call(this));return o.name="VKError",o.message=a,o.error_code=n,o.stack=(new Error).stack,o}return s()(t,e),t}(Error);t.a=l},68:function(e,t){!function(e){"use strict";function t(e,t,a,n){var r,o,i,c,s,l,d,m=.3086*(1-n),u=.6094*(1-n),h=.082*(1-n),f=t<<2;for(i=0;i<a;i++)for(c=i*f,o=0;o<t;o++)r=c+(o<<2),s=e[r],l=e[r+1],d=e[r+2],e[r]=(m+n)*s+u*l+h*d,e[r+1]=m*s+(u+n)*l+h*d,e[r+2]=m*s+u*l+(h+n)*d}function a(e,a,c,s,l){var d=new Uint8Array(a*c*4);n(e,d,a,c,s),o(d,e,a,c,s),r(e,d,a,c,s),i(d,e,a,c,s),void 0!==l&&1!==l&&t(e,a,c,l)}function n(e,t,a,n,r){var o,i,c,s,l,d,m,u,h,f=r<<2,p=a<<2;for(i=0;i<n;i++){for(d=0,m=0,u=0,h=0,c=i*p,o=0;o<r;o++)s=c+(o<<2),d+=e[s],m+=e[s+1],u+=e[s+2],h+=e[s+3],t[s]=d/(o+1)|0,t[s+1]=m/(o+1)|0,t[s+2]=u/(o+1)|0,t[s+3]=h/(o+1)|0;for(;o<a;o++)s=c+(o<<2),l=s-f,t[s]=d/r|0,t[s+1]=m/r|0,t[s+2]=u/r|0,t[s+3]=h/r|0,d+=e[s]-e[l],m+=e[s+1]-e[l+1],u+=e[s+2]-e[l+2],h+=e[s+3]-e[l+3]}}function r(e,t,a,n,r){var o,i,c,s,l,d,m,u,h,f=r<<2,p=a<<2;for(i=0;i<n;i++){for(d=0,m=0,u=0,h=0,c=i*p,o=a-1;o>=a-r;o--)s=c+(o<<2),d+=e[s],m+=e[s+1],u+=e[s+2],h+=e[s+3],t[s]=d/(a-o)|0,t[s+1]=m/(a-o)|0,t[s+2]=u/(a-o)|0,t[s+3]=h/(a-o)|0;for(;o>=0;o--)s=c+(o<<2),l=s+f,t[s]=d/r|0,t[s+1]=m/r|0,t[s+2]=u/r|0,t[s+3]=h/r|0,d+=e[s]-e[l],m+=e[s+1]-e[l+1],u+=e[s+2]-e[l+2],h+=e[s+3]-e[l+3]}}function o(e,t,a,n,r){var o,i,c,s,l,d,m,u,h,f=a<<2,p=f*r;for(o=0;o<a;o++){for(d=0,m=0,u=0,h=0,c=o<<2,i=0;i<r;i++)s=c+i*f,d+=e[s],m+=e[s+1],u+=e[s+2],h+=e[s+3],t[s]=d/(i+1)|0,t[s+1]=m/(i+1)|0,t[s+2]=u/(i+1)|0,t[s+3]=h/(i+1)|0;for(;i<n;i++)s=c+i*f,l=s-p,t[s]=d/r|0,t[s+1]=m/r|0,t[s+2]=u/r|0,t[s+3]=h/r|0,d+=e[s]-e[l],m+=e[s+1]-e[l+1],u+=e[s+2]-e[l+2],h+=e[s+3]-e[l+3]}}function i(e,t,a,n,r){var o,i,c,s,l,d,m,u,h,f=a<<2,p=f*r;for(o=0;o<a;o++){for(d=0,m=0,u=0,h=0,c=o<<2,i=n-1;i>=n-r;i--)s=c+i*f,d+=e[s],m+=e[s+1],u+=e[s+2],h+=e[s+3],t[s]=d/(n-i)|0,t[s+1]=m/(n-i)|0,t[s+2]=u/(n-i)|0,t[s+3]=h/(n-i)|0;for(;i>=0;i--)s=c+i*f,l=s+p,t[s]=d/r|0,t[s+1]=m/r|0,t[s+2]=u/r|0,t[s+3]=h/r|0,d+=e[s]-e[l],m+=e[s+1]-e[l+1],u+=e[s+2]-e[l+2],h+=e[s+3]-e[l+3]}}function c(e,t,n,r,o,i){var c=this,d=c.canvas,m=0|n,u=0|r,h=0|e,f=0|t;o=32*(0|o),o=Math.min(Math.max(o,32),256);var p=Math.max(0,Math.log(o)/Math.log(2)-3|0),v=o>>>p,g=d.width>>>p,E=d.height>>>p;l.drawImage(d,0,0,g,E);var k=l.getImageData(0,0,g,E);return a(k.data,g,E,v,i),l.putImageData(k,0,0),l.drawImage(s,0,0,g,E,0,0,d.width,d.height),c.drawImage(s,h,f,m,u,h,f,m,u),c}var s=document.createElement("canvas");s.width=screen.width,s.height=screen.height;var l=s.getContext("2d");e.CanvasRenderingContext2D.prototype._blurRect=c}(window)}},[139]);