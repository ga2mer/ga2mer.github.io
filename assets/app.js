webpackJsonp([0],{171:function(module,exports,__webpack_require__){"use strict";(function(global){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function App(props){return _react2["default"].createElement("div",{className:"app"},_react2["default"].createElement(_header2["default"],{currentRoute:props.location.pathname}),props.children)}__webpack_require__(226);var _react=__webpack_require__(5),_react2=_interopRequireDefault(_react),_reactDom=__webpack_require__(249),_reactRouter=__webpack_require__(137),_header=__webpack_require__(174),_header2=_interopRequireDefault(_header),_home=__webpack_require__(175),_home2=_interopRequireDefault(_home),_graffiti=__webpack_require__(173),_graffiti2=_interopRequireDefault(_graffiti),_error=__webpack_require__(172),_error2=_interopRequireDefault(_error);global.Promise=__webpack_require__(182),(0,_reactDom.render)(_react2["default"].createElement(_reactRouter.Router,{history:_reactRouter.browserHistory},_react2["default"].createElement(_reactRouter.Route,{path:"/",component:App},_react2["default"].createElement(_reactRouter.IndexRoute,{component:_home2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"graffiti",component:_graffiti2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"*",component:_error2["default"]}))),document.querySelector("#root"))}).call(exports,__webpack_require__(170))},172:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function Error(){return _react2["default"].createElement("div",{className:"container center-text",style:{maxWidth:"450px"}},_react2["default"].createElement("img",{src:_ram2["default"],className:"img-fluid"}))}exports.__esModule=!0,exports["default"]=Error;var _react=__webpack_require__(5),_react2=_interopRequireDefault(_react),_ram=__webpack_require__(341),_ram2=_interopRequireDefault(_ram)},173:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _promise=__webpack_require__(179),_promise2=_interopRequireDefault(_promise),_classCallCheck2=__webpack_require__(105),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(107),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(106),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(5),_react2=_interopRequireDefault(_react),_fetchJsonp=__webpack_require__(242),_fetchJsonp2=_interopRequireDefault(_fetchJsonp),_VKError=__webpack_require__(176),_VKError2=_interopRequireDefault(_VKError),Graffiti=function(_Component){function Graffiti(props){(0,_classCallCheck3["default"])(this,Graffiti);var _this=(0,_possibleConstructorReturn3["default"])(this,_Component.call(this,props));return _this.parseJSON=function(response){return response.json()},_this.handleChangeToken=function(e){_this.setState({token:e.target.value,tokenValid:/access_token=(.+)&expires_in/.test(e.target.value)})},_this.handleURL=function(e){_this.setState({url:e.target.value})},_this.handleLink=function(){_this.setState({error:"",message:"",link:""});var tokenEl=_this.state.token,fileEl=_this.file;if(0==fileEl.files.length&&0==_this.state.url.length)return _this.setState({error:"Не выбран файл или не заполнено поле юрл"}),!1;var _$exec=/access_token=(.+)&expires_in/.exec(tokenEl),token=_$exec[1],fd=new FormData;fd.append("file",fileEl.files[0]);var regexHttps=/pu\.vk\.com\/c(\d+)\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)&api=1/i,regexHttp=/cs(\d+)\.vk\.com\/upload\.php\?act=add_doc&mid=(\d+)&aid=0&gid=0&type=graffiti&hash=([a-z0-9]+)&rhash=([a-z0-9]+)/i;_this.setState({message:"Загрузка изображения, подождите"}),(0,_fetchJsonp2["default"])("https://api.vk.com/method/docs.getUploadServer?v=5.54&access_token="+token+"&type=graffiti").then(_this.checkStatusP).then(_this.parseJSON).then(function(uploadServer){var isHTTPS=regexHttps.test(uploadServer.response.upload_url),regex=isHTTPS&&regexHttps||regexHttp,_regex$exec=regex.exec(uploadServer.response.upload_url),c=_regex$exec[1],mid=_regex$exec[2],hash=_regex$exec[3],rhash=_regex$exec[4];return fileEl.files.length>0?fetch("https://akigami.ru/vkgraffiti/upload_by_file?c="+c+"&mid="+mid+"&hash="+hash+"&rhash="+rhash,{method:"POST",body:fd}).then(_this.checkStatus).then(_this.parseJSON):_this.state.url?fetch("https://akigami.ru/vkgraffiti/upload_by_url?url="+_this.state.url+"&c="+c+"&mid="+mid+"&hash="+hash+"&rhash="+rhash,{method:"POST"}).then(_this.checkStatus).then(_this.parseJSON):void 0}).then(function(responseFile){return(0,_fetchJsonp2["default"])("https://api.vk.com/method/docs.save?v=5.54&access_token="+token+"&file="+responseFile.file).then(_this.parseJSON)}).then(function(responseDoc){var doc=responseDoc.response[0],link="https://vk.com/doc"+doc.owner_id+"_"+doc.id;_this.setState({link:link,err:"",message:""})})["catch"](function(err){return err instanceof _VKError2["default"]?_this.setState({error:err.message,link:"",message:""}):void _this.setState({error:err.message,link:"",message:""})})},_this.handleClearFile=function(){_this.file.value=""},_this.handleCopyLink=function(){_this.copyToClipboard(_this.state.link)},_this.state={token:"",tokenValid:!1,url:"",error:"",link:"",message:""},_this}return(0,_inherits3["default"])(Graffiti,_Component),Graffiti.prototype.checkStatus=function(response){return response.status>=200&&response.status<300?response:response.json().then(function(json){var message;if(json.message)message="File too large"==json.message&&"Размер файла превышает 4мб"||json.message;else if(json.error&&json.error.error_code)return _promise2["default"].reject(new _VKError2["default"](json.error.error_msg,json.error.error_code));return _promise2["default"].reject(new Error(message))})},Graffiti.prototype.checkStatusP=function(response){return response.json().then(function(json){return json.response?response:json.error&&json.error.error_code?_promise2["default"].reject(new _VKError2["default"](json.error.error_msg,json.error.error_code)):json.error?_promise2["default"].reject(new Error(json.error.error_msg)):void 0})},Graffiti.prototype.handleGetToken=function(){window.open("https://oauth.vk.com/authorize?client_id=5553668&scope=docs&response_type=token")},Graffiti.prototype.handleSelectAll=function(e){e.target.setSelectionRange(0,e.target.value.length)},Graffiti.prototype.copyToClipboard=function(text){var input=document.createElement("input");input.style.position="fixed",input.style.opacity=0,input.value=text,document.body.appendChild(input),input.select(),document.execCommand("Copy"),document.body.removeChild(input)},Graffiti.prototype.render=function(){var _this2=this;return _react2["default"].createElement("div",{className:"container"},_react2["default"].createElement("div",{className:"container center-text",style:{maxWidth:"450px"}},"Здесь когда-нибудь будет описание",_react2["default"].createElement("form",null,_react2["default"].createElement("label",{htmlFor:"token"},"Адрес с access_token"),_react2["default"].createElement("div",{className:"input-group"},_react2["default"].createElement("input",{id:"token",type:"text",className:"form-control sharp",value:this.state.token,onChange:this.handleChangeToken,placeholder:"https://oauth.vk.com/blank..."}),_react2["default"].createElement("span",{className:"input-group-btn"},_react2["default"].createElement("button",{className:"btn btn-primary sharp",type:"button",onClick:this.handleGetToken},"Получить"))),_react2["default"].createElement("label",{htmlFor:"file"},"Изображение в формате: png, jpg или gif"),_react2["default"].createElement("div",{className:"input-group"},_react2["default"].createElement("input",{id:"file",className:"form-control sharp",disabled:!this.state.tokenValid||this.state.url.length>0,ref:function(c){return _this2.file=c},type:"file"}),_react2["default"].createElement("span",{className:"input-group-btn"},_react2["default"].createElement("button",{className:"btn btn-primary sharp",type:"button",disabled:!this.state.tokenValid||this.state.url.length>0,onClick:this.handleClearFile},"Очистить"))),_react2["default"].createElement("div",{className:"strike"},_react2["default"].createElement("span",null,"или ссылку на изображение")),_react2["default"].createElement("input",{className:"form-control sharp",disabled:!this.state.tokenValid,type:"text",value:this.state.url,onKeyUp:this.handleURL,placeholder:"e.g. http://i.imgur.com/cPuty2U.png"}),_react2["default"].createElement("div",{className:"divider"}),_react2["default"].createElement("div",null,_react2["default"].createElement("button",{className:"btn btn-secondary sharp",type:"button",disabled:!this.state.tokenValid,onClick:this.handleLink},"Получить ссылку")),(this.state.error||this.state.message||this.state.link)&&_react2["default"].createElement("div",{className:"divider"}),this.state.error&&_react2["default"].createElement("div",{className:"alert alert-danger",role:"alert"},this.state.error),this.state.message&&_react2["default"].createElement("div",{className:"alert alert-info",role:"alert"},this.state.message),this.state.link&&_react2["default"].createElement("div",{className:"alert alert-success",role:"alert"},_react2["default"].createElement("div",{className:"input-group"},_react2["default"].createElement("input",{type:"text",className:"form-control sharp",readOnly:!0,onClick:this.handleSelectAll,defaultValue:this.state.link}),_react2["default"].createElement("span",{className:"input-group-btn"},_react2["default"].createElement("button",{className:"btn btn-primary sharp",type:"button",onClick:this.handleCopyLink},"Скопировать")))))))},Graffiti}(_react.Component);exports["default"]=Graffiti},174:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function Header(_ref){var currentRoute=_ref.currentRoute;return _react2["default"].createElement("nav",{className:"navbar navbar-pills navbar-fixed-top",style:{background:"white"}},_react2["default"].createElement("ul",{className:"nav nav-pills navbar-nav"},_react2["default"].createElement("li",{className:(0,_classnames2["default"])({"nav-item":!0,active:"/"==currentRoute})},_react2["default"].createElement(_reactRouter.Link,{className:"nav-link",to:"/"},"Me")),_react2["default"].createElement("li",{className:(0,_classnames2["default"])({"nav-item":!0,active:"/graffiti"==currentRoute})},_react2["default"].createElement(_reactRouter.Link,{className:"nav-link",to:"/graffiti"},"Graffiti"))))}exports.__esModule=!0,exports["default"]=Header;var _react=__webpack_require__(5),_react2=_interopRequireDefault(_react),_reactRouter=__webpack_require__(137),_classnames=__webpack_require__(183),_classnames2=_interopRequireDefault(_classnames)},175:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function Home(){return _react2["default"].createElement("div",{className:"vertical-center"},_react2["default"].createElement("div",{className:"container center-text",style:{maxWidth:"450px"}},_react2["default"].createElement("img",{src:_nagisa2["default"],className:"img-fluid"}),_react2["default"].createElement("ul",{className:"links"},_react2["default"].createElement("li",null,_react2["default"].createElement("a",{href:"https://vk.com/ga2mer_o_o"},"VK")),_react2["default"].createElement("li",null,_react2["default"].createElement("a",{href:"https://twitter.com/ga2mer_ru"},"Twitter")))))}exports.__esModule=!0,exports["default"]=Home;var _react=__webpack_require__(5),_react2=_interopRequireDefault(_react),_nagisa=__webpack_require__(340),_nagisa2=_interopRequireDefault(_nagisa)},176:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports.__esModule=!0;var _classCallCheck2=__webpack_require__(105),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(107),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(106),_inherits3=_interopRequireDefault(_inherits2),VKError=function(_Error){function VKError(error,error_code){(0,_classCallCheck3["default"])(this,VKError);var _this=(0,_possibleConstructorReturn3["default"])(this,_Error.call(this));return _this.name="VKError",_this.message=error,_this.error_code=error_code,_this.stack=(new Error).stack,_this}return(0,_inherits3["default"])(VKError,_Error),VKError}(Error);exports["default"]=VKError},226:function(module,exports){},340:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"nagisa.png"},341:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"ram.png"},342:function(module,exports,__webpack_require__){module.exports=__webpack_require__(171)}},[342]);